name: CI - Development   # The name of this workflow

on:
  push:
    branches:
      - master           # This workflow triggers automatically whenever code is pushed to the master branch

jobs:
  test-and-build:
    runs-on: ubuntu-latest   # The job runs inside the latest Ubuntu Linux environment

    steps:
      - name: Checkout code
        uses: actions/checkout@v4   # Downloads your repository into the runner so the workflow can access the project files

      - name: Setup PHP
        uses: shivammathur/setup-php@v2   # Installs PHP in the runner
        with:
          php-version: '8.4'              # Specifies PHP version 8.4 for the environment
          extensions: mbstring, xml, bcmath, intl   # Installs required PHP extensions for Laravel

      - name: Install Composer dependencies
        run: composer install --no-dev --optimize-autoloader
        # Installs PHP dependencies for the application, excluding dev packages,
        # and optimizes autoloading to mirror production behavior.

      - name: Install NPM dependencies
        run: npm ci
        # Installs JavaScript dependencies using a clean, reproducible method based on package-lock.json

      - name: Build assets
        run: npm run build
        # Compiles frontend assets (CSS/JS) using Vite or Mix and outputs optimized production files

      - name: Run tests
        run: php artisan pest || php artisan phpunit || echo "No tests found - continuing"
        # Attempts to run the project's test suite:
        # 1. Runs Pest tests if available
        # 2. Falls back to PHPUnit if Pest is missing
        # 3. If no tests exist, it prints a message and continues without failing the workflow

      - name: Create ZIP artifact
        run: |
          zip -r deploy-dev.zip . -x "vendor/*" "node_modules/*" ".git/*" "tests/*"
        # Creates a ZIP file of the application for deployment or reuse,
        # excluding unnecessary and heavy directories (vendor, node_modules, Git data, and test files)

      - name: Upload artifact
        uses: actions/upload-artifact@v4
        with:
          name: deploy-dev-zip     # The name of the uploaded file visible in GitHub Actions UI
          path: deploy-dev.zip     # The path to the ZIP file you just created
        # Uploads the ZIP artifact so it can be reused by other workflows (e.g., CD pipeline)
